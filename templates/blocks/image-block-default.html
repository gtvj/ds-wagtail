{% load wagtailimages_tags wagtailcore_tags %}
{% image value.image width-600 as block_image %}

{% if value.image %}
    {% if value.caption %}
        <figure class="image-block">
            <picture>
                {% image value.image max-832x591 format-webp as desktop_img %}
                <source media="(min-width: 760px)" srcset="{{ desktop_img.url }}"/>
                {% image value.image max-832x591 as desktop_image %}
                <source media="(min-width: 760px)" srcset="{{ desktop_img.url }}"/>
                {% image value.image max-390x265 format-webp as mobile_img %}
                <source media="(max-width: 759px)" srcset="{{ mobile_img.url }}"/>
                {% image value.image max-390x265 as mobile_img %}
                <source media="(max-width: 759px)" srcset="{{ mobile_img.url }}"/>
                <img class="image-block__image{% if value.is_portrait %} image-block__image--portrait{% endif %}" width={{ mobile_img.width }} height={{ mobile_img.height }} src="{{ mobile_img.url }}" alt="{{ mobile_img.alt_text }}" />
                <button type="button" aria-label="read transcript" class="image-block__transcript">
                    <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="#FC0" d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41Z"/></svg>
                    Transcript
                </button>
            </picture>
            <figcaption class="image-block__caption">
                {{ value.caption|richtext }}
            </figcaption>
        </figure>
    {% else %}
        <picture class="image-block">
            {% image value.image max-832x591 format-webp as desktop_img %}
            <source media="(min-width: 760px)" srcset="{{ desktop_img.url }}"/>
            {% image value.image max-832x591 as desktop_image %}
            <source media="(min-width: 760px)" srcset="{{ desktop_img.url }}"/>
            {% image value.image max-390x265 format-webp as mobile_img %}
            <source media="(max-width: 759px)" srcset="{{ mobile_img.url }}"/>
            {% image value.image max-390x265 as mobile_img %}
            <source media="(max-width: 759px)" srcset="{{ mobile_img.url }}"/>
            <img class="image-block__image" width={{ mobile_img.width }} height={{ mobile_img.height }} src="{{ mobile_img.url }}" alt="{% if value.decorative %}{{ value.alt_text }}{% endif %}" />
            <button type="button" aria-label="read transcript" class="image-block__transcript">
                <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="#FC0" d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41Z"/></svg>
                Transcript
            </button> 
        </picture>
    {% endif %}
    <div data-js-transcript-tablist class="image-block__transcription">
        {# non-JS version #}
        {% if value.image.transcription or value.image.translation %}
            <div class="transcription__text">
                {% if value.image.transcription %}
                    <h2>{{ value.image.get_transcription_heading_display }}</h2>
                    {{ value.image.transcription|richtext }}
                {% endif %}
                {% if value.image.translation %}
                    <h2>{{ value.image.get_translation_heading_display }}</h2>
                    {{ value.image.translation|richtext }}
                {% endif %}
            </div>
        {% endif %}
        {# JS version #}
        {% if value.image.transcription or value.image.translation %}
            <div>
                <div role="tablist" class="transcription__tablist hidden">
                    {% if value.image.transcription %}
                        <button id="tab-1"
                                class="transcription__tab"
                                type="button"
                                role="tab"
                                aria-selected="true"
                                aria-controls="tabpanel-1"
                                data-component-name="Image gallery"
                                data-link-type="Tab"
                                data-link="{{ value.image.get_transcription_heading_display }}"
                                data-transcription-tab>
                            {{ value.image.get_transcription_heading_display }}
                        </button>
                    {% endif %}
                    {% if value.image.translation %}
                        <button id="tab-2"
                                class="transcription__tab"
                                type="button"
                                role="tab"
                                aria-selected="false"
                                aria-controls="tabpanel-2"
                                tabindex="-1"
                                data-component-name="Image gallery"
                                data-link-type="Tab"
                                data-link="{{ value.image.get_translation_heading_display }}"
                                data-translation-tab>
                            {{ value.image.get_translation_heading_display }}
                        </button>
                    {% endif %}
                </div>
                {% if value.image.transcription %}
                    <div id="tabpanel-1"
                            role="tabpanel"
                            tabindex="0"
                            aria-labelledby="tab-1"
                            class="transcription__tabpanel hidden">
                        {{ value.image.transcription|richtext }}
                    </div>
                {% endif %}
                {% if value.image.translation %}
                    <div id="tabpanel-2"
                            role="tabpanel"
                            tabindex="0"
                            aria-labelledby="tab-2"
                            class="transcription__tabpanel hidden">
                        {{ value.image.translation|richtext }}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endif %}
    