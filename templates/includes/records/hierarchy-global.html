{% load records_tags %}

<nav class="hierarchy-global" data-container-name="hierarchy-global" id="analytics-hierarchy-global">

    <details id="js-hierarchy-global" open>
        <summary>
            <div class="hierarchy-global__heading">
                <h2>Where am I in the catalogue?</h2>
            </div>
        </summary>

        <ul class="hierarchy-global__list">
            {% for item in page.hierarchy %}
                {% is_page_current_item_in_hierarchy page item as is_current_item %}
                {% if is_current_item %}
                    <li class="hierarchy-global__list-item hierarchy-global__list-item--current-item">
                        <span class="hierarchy-global__location">You are here:</span>
                        <span class="hierarchy-global__reference hierarchy-global__reference--white">{{ item.reference_number }}</span> {{ item.title }}
                    </li>
                {% else %}
                    <li class="hierarchy-global__list-item">
                        <span class="hierarchy-global__reference">{{ item.reference_number }}</span>
                        <a href="{% url 'details-page-human-readable' item.reference_number %}"  data-link="{{ forloop.counter0 }}: {{ item.reference_number }}">
                            {{ item.title }}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </details>
</nav>


<!--

This JS handles the expand/collapse of the details/summary list element across different screen sizes.
It has been stored in here whilst the JS build system is in development. When that system has been finished and merged, this code block should be moved from here into those JS files.

-->
<script>

    // Set the details element as open at 1200px or above
    var manage_details_element = function() {

        var details_element = document.getElementById('js-hierarchy-global'),
            summary_element = document.querySelector('#js-hierarchy-global summary');

        if(!!details_element) {

            if(window.innerWidth < 1200) {
                details_element.removeAttribute('open');
                summary_element.setAttribute('tabindex', '0');
            } else {
                details_element.setAttribute('open', '');
                summary_element.setAttribute('tabindex', '-1');
            }
        }
    };

    // Prevent the details element from closing at 1200px or above
    var details_element = document.getElementById('js-hierarchy-global');

    details_element.addEventListener('click', function(e) {

        if(window.innerWidth < 1200) {
            return;
        }

        e.preventDefault();

    });

    // Register event handlers
    document.addEventListener("DOMContentLoaded", function() {
        manage_details_element();
    });

    window.addEventListener("resize", function() {
        manage_details_element();
    });

</script>