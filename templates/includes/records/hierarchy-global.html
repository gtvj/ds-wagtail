{% load records_tags %}

<nav class="hierarchy" data-container-name="hierarchy-global">
    <div class="hierarchy__container">
        <div class="hierarchy-short-panel">
            <h2 class="hierarchy-short-panel__heading sr-only">Catalogue location at a glance</h2>
            <p class="hierarchy-short-panel__label">You are here:</p>

            <!-- START COMMENT 1:

            The 'short panel__list' section should only display up to a maximum of 3 list items at one time.
            These should display only the 'major' levels above the level you're on i.e Archive, Dept, Division, Series (don't include 'sub-levels' or 'sub-sub-levels').
            If the archive level is not the first item in the list, the first item should display the 'hierarchy-short-panel__list-item--more' modifier class to indicate there are more levels above by displaying the '...' before the list item, which is automatically handled by the CSS.
            If the Archive level is visible as the first item, this modifier doesn't need to be added.

            -->

            <ul class="hierarchy-short-panel__list">
                {% if page.hierarchy %}
                    {% if page.hierarchy|length <= 2 %}
                        <li class="hierarchy-short-panel__list-item">
                            <span class="hierarchy-short-panel__level">
                                <a href="#">Archive</a>
                            </span>({{ page.template.heldBy }})
                        </li>
                    {% endif %}
                    
                    {% for item in page.hierarchy %}
                        {% is_page_current_item_in_hierarchy page item as is_current_item %}

                        {% if forloop.counter == 1 and not is_current_item %}
                            {% if page.hierarchy|length == 3 %}
                                <li class="hierarchy-short-panel__list-item hierarchy-short-panel__list-item--more">
                                    <span class="hierarchy-short-panel__level">
                                        <a href="{% record_url item%}">Department</a>
                                    </span>({{ item.reference_number }})
                                </li>
                            {% elif page.hierarchy|length == 2 %}
                                <li class="hierarchy-short-panel__list-item">
                                    <span class="hierarchy-short-panel__level">
                                        <a href="{% record_url item%}">Department</a>
                                    </span>({{ item.reference_number }})
                                </li>
                            {% endif %}

                        {% elif forloop.counter == 2 and not is_current_item %}
                            {% if page.hierarchy|length > 3 %}
                                <li class="hierarchy-short-panel__list-item hierarchy-short-panel__list-item--more">
                                    <span class="hierarchy-short-panel__level">
                                        <a class="hierarchy-short-panel__link" href="{% record_url item %}">Series</a>
                                    </span>({{ item.reference_number }})
                                </li>
                            {% else %}
                                <li class="hierarchy-short-panel__list-item">
                                    <span class="hierarchy-short-panel__level">
                                        <a class="hierarchy-short-panel__link" href="{% record_url item %}">Series</a>
                                    </span>({{ item.reference_number }})
                                </li>
                            {%endif%}

                        {% elif forloop.counter == 3 and not is_current_item %}
                            <li class="hierarchy-short-panel__list-item">
                                <span class="hierarchy-short-panel__level">
                                    <a class="hierarchy-short-panel__link" href="{% record_url item %}">Piece</a>
                                </span>({{ item.reference_number }})
                            </li>

                        {% elif is_current_item %}
                            <li class="hierarchy-short-panel__list-item hierarchy--short-panel__list-item--current">
                                <span class="hierarchy-short-panel__level">This {{ page.level|lower }}</span>({{ item.reference_number }})
                            </li>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <li class="hierarchy-short-panel__list-item">
                        <span class="hierarchy-short-panel__level">
                            <a href="#">Archive</a>
                        </span>({{ page.template.heldBy }})
                    </li>
                    <li class="hierarchy-short-panel__list-item hierarchy--short-panel__list-item--current">
                        <span class="hierarchy-short-panel__level">This department</span>({{ page.reference_number }})
                    </li>
                {% endif %}
            </ul>
            <!-- END COMMENT 1-->
        </div>
        <div class="hierarchy-short-panel__toggle-link" data-id="hierarchy-toggle-link"></div>
        <nav class="hierarchy-full-panel" data-id="hierarchy-detailed-view">
            <h2 class="hierarchy-full-panel__heading">Detailed catalogue location:</h2>

            <!-- START COMMENT 2:

            These levels need to be worked on so they are dynamically added.
            The 'hierarchy-full-panel__bar-container-inner--level-1' modifier adds the width of the bar depending on the level.
            These always need to be added in stepped order - don't skip levels - so the widths descend by 2% each time (eg. only 1, 2, 3, 4 and not 1, 3, 4, 6).

            -->

            <!-- Level 1 -->
            <div class="hierarchy-full-panel__bar-container-outer">
                <div class="hierarchy-full-panel__bar-container-inner hierarchy-full-panel__bar-container-inner--level-1">
                    <p><span class="hierarchy-full-panel__bar-number">N</span>
                    <span class="hierarchy-full-panel__bar-label">records</span></p>
                </div>
                <div class="hierarchy-full-panel__text-container">
                    <p class="hierarchy-full-panel__text-level">This record is held at: <a href="">{{page.template.heldBy}}</a></p>
                    <p class="hierarchy-full-panel__text-title">Located at DATA TO GO HERE</p>
                </div>
            </div>
            {% if page.hierarchy %}
                {% for item in page.hierarchy %}
                    {% is_page_current_item_in_hierarchy page item as is_current_item %}
                    <!-- Level 2 -->
                    {% if item.level_code == 1 or forloop.counter == 1 %}
                        <div class="hierarchy-full-panel__bar-container-outer">
                            <div class="hierarchy-full-panel__bar-container-inner {% if is_current_item %} hierarchy-full-panel__bar-container-inner--active {% endif %} hierarchy-full-panel__bar-container-inner--level-2">
                                <p><span class="hierarchy-full-panel__bar-number">N</span>
                            <span class="hierarchy-full-panel__bar-label">records</span></p>
                            </div>
                            <div class="hierarchy-full-panel__text-container">
                                <p class="hierarchy-full-panel__text-level">{% if is_current_item %}You are currently looking at{% else %}In{% endif %} the department: <a href="{% record_url item %}">{{item.reference_number}}</a></p>
                                <p class="hierarchy-full-panel__text-title">{{item.title}}</p>
                            </div>
                        </div>
                    
                    <!-- Level 3 -->
                    <!--Commenting out due to missing data
                        {#{% elif item.level_code == 2 or forloop.counter == 2 %}#}
                        <div class="hierarchy-full-panel__bar-container-outer">
                            <div class="hierarchy-full-panel__bar-container-inner {% if is_current_item %} hierarchy-full-panel__bar-container-inner--active {% endif %} hierarchy-full-panel__bar-container-inner--level-3">
                                <p><span class="hierarchy-full-panel__bar-number">N</span>
                                <span class="hierarchy-full-panel__bar-label">records</span></p>
                            </div>
                            <div class="hierarchy-full-panel__text-container">
                                <p class="hierarchy-full-panel__text-level">{% if is_current_item %}You are currently looking at{% else %}Within{% endif %} the division: <a href="{% record_url item %}">{{item.reference_number}}</a></p>
                                <p class="hierarchy-full-panel__text-title">{{item.title}}</p>
                            </div>
                        </div>
                    -->
                    <!-- Level 4 -->
                    <!-- forloop.counter should be equal to 3 however due to missing data it will be 2 -->
                    {% elif item.level_code == 3 or forloop.counter == 2 %}
                        <div class="hierarchy-full-panel__bar-container-outer">
                            <div class="hierarchy-full-panel__bar-container-inner {% if is_current_item %} hierarchy-full-panel__bar-container-inner--active {% endif %} hierarchy-full-panel__bar-container-inner--level-4">
                                <p><span class="hierarchy-full-panel__bar-number">N</span>
                                <span class="hierarchy-full-panel__bar-label">records</span></p>
                            </div>
                            <div class="hierarchy-full-panel__text-container">
                                <p class="hierarchy-full-panel__text-level">{% if is_current_item %}You are currently looking at{% else %}Within{% endif %} the series: <a href="{% record_url item %}">{{item.reference_number}}</a></p>
                                <p class="hierarchy-full-panel__text-title">{{item.title}}</p>
                            </div>
                        </div>

                    <!-- Level 5 -->
                    <!--Commenting out due to missing data
                    {#{% elif item.level_code == 4 or forloop.counter == 4 %}#}
                        <div class="hierarchy-full-panel__bar-container-outer">
                            <div class="hierarchy-full-panel__bar-container-inner {% if is_current_item %} hierarchy-full-panel__bar-container-inner--active {% endif %} hierarchy-full-panel__bar-container-inner--level-5">
                                <p><span class="hierarchy-full-panel__bar-number">N</span>
                                <span class="hierarchy-full-panel__bar-label">records</span></p>
                            </div>
                            <div class="hierarchy-full-panel__text-container">
                                <p class="hierarchy-full-panel__text-level">{% if is_current_item %}You are currently looking at{% else %}Within{% endif %} the sub-series: <a href="{% record_url item %}">{{item.reference_number}}</a></p>
                                <p class="hierarchy-full-panel__text-title">{{item.title}}</p>
                            </div>
                        </div>
                    -->
                    <!-- Level 6 -->
                    <!--As above, should be 5 but missing data prevents this-->
                    {% elif item.level_code == 6 or forloop.counter == 3 %}
                        <div class="hierarchy-full-panel__bar-container-outer">
                            <div class="hierarchy-full-panel__bar-container-inner {% if is_current_item %} hierarchy-full-panel__bar-container-inner--active {% endif %} hierarchy-full-panel__bar-container-inner--level-6">
                                <p><span class="hierarchy-full-panel__bar-number">N</span>
                                    <span class="hierarchy-full-panel__bar-label">records</span></p>
                            </div>
                            <div class="hierarchy-full-panel__text-container">
                                <p class="hierarchy-full-panel__text-level">{% if is_current_item %}You are currently looking at{% else %}Within{% endif %} the piece: <a href="{% record_url item %}">{{item.reference_number}}</a></p>
                                <p class="hierarchy-full-panel__text-title">{{item.title}}</p>
                            </div>
                        </div>

                    <!-- Level 7 -->
                    {% elif item.level_code == 7 or forloop.counter == 6 %}
                        <div class="hierarchy-full-panel__bar-container-outer hierarchy-full-panel__bar-container-outer--active">
                            <div class="hierarchy-full-panel__bar-container-inner {% if is_current_item %} hierarchy-full-panel__bar-container-inner--active {% endif %} hierarchy-full-panel__bar-container-inner--level-7">
                                <p><span class="hierarchy-full-panel__bar-number">1</span>
                                    <span class="hierarchy-full-panel__bar-label">record</span></p>
                            </div>
                            <div class="hierarchy-full-panel__text-container">
                                <p class="hierarchy-full-panel__text-level">{% if is_current_item %} You are currently looking at {% endif %} the item: <a href="{% record_url item %}">{{item.reference_number}}</a></p>
                                <p class="hierarchy-full-panel__text-title">{{item.title}}</p>
                            </div>
                        </div>
                    {%endif%}
                {%endfor%}
            {% else %}
                <div class="hierarchy-full-panel__bar-container-outer">
                    <div class="hierarchy-full-panel__bar-container-inner hierarchy-full-panel__bar-container-inner--active hierarchy-full-panel__bar-container-inner--level-2">
                        <p><span class="hierarchy-full-panel__bar-number">N</span>
                    <span class="hierarchy-full-panel__bar-label">records</span></p>
                    </div>
                    <div class="hierarchy-full-panel__text-container">
                        <p class="hierarchy-full-panel__text-level">You are currently looking at the department: <a href="{% record_url page %}">{{page.reference_number}}</a></p>
                        <p class="hierarchy-full-panel__text-title">{{page.title}}</p>
                    </div>
                </div>
            {%endif%}
            <!-- END COMMENT 2 -->


            <!-- START COMMENT 3:

            The next section 'hierarchy-local-nav' section will only need to be shown if there is a previous and/or a next item available.
            It won't need it to be shown if it's only showing the current item

            -->


          <nav class="hierarchy-local-nav" role="navigation" aria-label="Next and previous records">

                <!-- Previous item in series -->
                <div class="hierarchy-local-nav__container hierarchy-local-nav__container--previous">
                    {% if page.previous_record %}
                        {% if page.previous_record.has_reference_number %}
                            <p class="hierarchy-local-nav__list-label hierarchy-local-nav__list-label--left">{{ 'previous_record'|as_label }} in series <a href="{% record_url page.previous_record %}" class="hierarchy-local-nav__list-link" data-link="Previous" rel="prev">{{ page.previous_record.reference_number }}</a></p>
                        {% elif page.is_tna %}
                                {{ 'previous_record'|as_label }} {{ page.level.lower|default:"record" }}
                        {% else %}
                                {{ 'previous_record'|as_label }} record
                        {% endif %}
                    {% endif %}
                </div>

                <!-- Current item in series -->
                <div class="hierarchy-local-nav__container hierarchy-local-nav__container--current">
                    <p class="hierarchy-local-nav__list-label">You are looking at <span class="hierarchy-local-nav__list-link" rel="current" aria-current="page">{{ page.reference_number }}</span></p>
                </div>


                <!-- Next item in series -->
                <div class="hierarchy-local-nav__container hierarchy-local-nav__container--next">
                    {% if page.next_record %}
                        {% if page.next_record.has_reference_number %}
                            <p class="hierarchy-local-nav__list-label hierarchy-local-nav__list-label--right">{{ 'next_record'|as_label }} in series <a href="{% record_url page.next_record %}" class="hierarchy-local-nav__list-link" data-link="Next" rel="next">{{ page.next_record.reference_number }}</a></p>
                            {% elif page.is_tna %}
                                {{ 'next_record'|as_label }} {{ page.level.lower|default:"record" }}
                            {% else %}
                                {{ 'next_record'|as_label }} record
                        {% endif %}
                    {% endif %}
                </div>
            <!-- END COMMENT 3 -->
          </nav>
    </div>
</nav>


{% comment%}

<!-- START COMMENT 4: This it the previous code for reference -->

<nav class="hierarchy-global" data-container-name="hierarchy-global" id="analytics-hierarchy-global">
    <details id="js-hierarchy-global" open>
        <summary id="analytics-hierarchy-link">
            <h2 class="hierarchy-global__heading" id="hierarchy-label">{{ 'hierarchy'|as_label }}</h2>
        </summary>

        <ol class="hierarchy-global__list" aria-labelledby="hierarchy-label">
            {% for item in page.hierarchy %}
                {% is_page_current_item_in_hierarchy page item as is_current_item %}
                {% if is_current_item %}
                    <li class="hierarchy-global__list-item hierarchy-global__list-item--current-item">
                        <span class="hierarchy-global__location">You are here:</span>
                        <span class="hierarchy-global__reference hierarchy-global__reference--white">{{ item.reference_number }}</span> {{ item.title }}
                    </li>
                {% else %}
                    <li class="hierarchy-global__list-item">
                        <span class="hierarchy-global__reference">{{ item.reference_number }}</span>
                        <a href="{% record_url item %}"  data-link="{{ forloop.counter0 }}: {{ item.reference_number }}" class="link--bold">
                            {{ item.title }}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ol>
    </details>
</nav>

<!-- END COMMENT 4 -->
{% endcomment %}
