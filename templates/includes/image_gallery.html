{% load static wagtailimages_tags wagtailcore_tags %}
<div class="transcription">
    <div class="transcription__preview hidden">
        {% with gallery_length=gallery|length %}
            <p class="transcription__image-counter">Image 1 of {{ gallery_length }}</p>
            <picture>
                {% with first_gallery_item=gallery.0 %}
                    {% image first_gallery_item.image fill-1000x600 format-webp as image_webp %}
                    <source srcset="{{ image_webp.url }}"
                            type="image/webp"
                            {% if first_gallery_item.alt_text %}alt="{{ first_gallery_item.alt_text }}"{% endif %}/>
                    {% image first_gallery_item.image fill-1100x600 as image_png %}
                    <source srcset="{{ image_png.url }}"
                            type="image/png"
                            {% if first_gallery_item.alt_text %}alt="{{ first_gallery_item.alt_text }}"{% endif %}/>
                    {% image first_gallery_item.image fill-1100x600 as base_img %}
                    <img width="1000"
                         height="600"
                         src="{{ base_img.url }}"
                         class="transcription__image"
                         {% if first_gallery_item.alt_text %}alt="{{ first_gallery_item.alt_text }}"{% endif %}/>
                {% endwith %}
            </picture>
            {% include "static/images/icons/dashed-line.svg" with classes="transcription__underline" %}
            <button id="showButton" class="transcription__open">View images and transcripts</button>
        </div>
        <!--start of transcript element-->
        {% for item in gallery %}
            <div id="item-{{ forloop.counter }}">
                <p class="transcription__image-counter">Image {{ forloop.counter }} of {{ gallery_length }}</p>
                <div class="transcription__content">
                    <picture>
                        {% image item.image fill-890x800 format-webp as image_webp %}
                        <source srcset="{{ image_webp.url }}"
                                type="image/webp"
                                {% if item.alt_text %}alt="{{ item.alt_text }}"{% endif %}/>
                        {% image item.image fill-890x800 format-png as image_png %}
                        <source srcset="{{ image_png.url }}"
                                type="image/png"
                                {% if item.alt_text %}alt="{{ item.alt_text }}"{% endif %}/>
                        {% image item.image fill-890x800 as base_img %}
                        <img width="890"
                             height="800"
                             src="{{ base_img.url }}"
                             class="transcription__image"
                             {% if item.alt_text %}alt="{{ item.alt_text }}"{% endif %}/>
                    </picture>
                    {# non-JS version #}
                    <div class="transcription__text">
                        <h2>{{ item.image.transcription_heading }}</h2>
                        <p>{{ item.image.transcription|richtext }}</p>
                        {% if item.image.translation %}
                            <h2>{{ item.image.translation_heading }}</h2>
                            <p>{{ item.image.translation|richtext }}</p>
                        {% endif %}
                    </div>
                    {# JS version #}
                    <div>
                        <div role="tablist"
                             aria-labelledby="tablist-1-{{ forloop.counter }}"
                             class="transcription__tablist hidden">
                            <button id="tab-1-{{ forloop.counter }}"
                                    class="transcription__tab"
                                    type="button"
                                    role="tab"
                                    aria-selected="true"
                                    aria-controls="tabpanel-1-{{ forloop.counter }}">
                                <span>{{ item.image.transcription_heading }}</span>
                            </button>
                            {% if item.image.translation %}
                                <button id="tab-2-{{ forloop.counter }}"
                                        class="transcription__tab"
                                        type="button"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="tabpanel-2-{{ forloop.counter }}"
                                        tabindex="-1">
                                    <span>{{ item.image.translation_heading }}</span>
                                </button>
                            {% endif %}
                        </div>
                        <div id="tabpanel-1-{{ forloop.counter }}"
                             role="tabpanel"
                             tabindex="0"
                             aria-labelledby="tab-1-{{ forloop.counter }}"
                             class="transcription__tabpanel hidden">
                            <p>{{ item.image.transcription|richtext }}</p>
                        </div>
                        {% if item.image.translation %}
                            <div id="tabpanel-2-{{ forloop.counter }}"
                                 role="tabpanel"
                                 tabindex="0"
                                 aria-labelledby="tab-2-{{ forloop.counter }}"
                                 class="transcription__tabpanel hidden">
                                <p>{{ item.image.translation|richtext }}</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endwith %}
    <button class="transcription__close hidden" id="closeButton" type="button">
        Close
        {% include "static/images/fontawesome-svgs/x-mark.svg" with classes="transcription__icon" %}
    </button>
</div>
<!--end of transcript element-->
