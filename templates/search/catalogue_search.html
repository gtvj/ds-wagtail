{% load search_tags %}
{% load humanize %}

<style type="text/css" media="screen">
    .column {
        float: left;
        padding-left: 20px;
        padding-right: 20px;
    }

    .filters {
        width: 300px;
    }

    .results {
        width: 500px;
    }

    .sr-only {
        display: none;
    }

    ul li {
        list-style-type: none;
    }

    ul.pagination__list li {
        float: left;
        padding-left: 10px;
    }

    .errorlist {
        color: red;
    }
</style>

<h1>Catalogue search</h1>

<ul>
    {% comment %}<li><a href="{% url 'search-featured' %}?keyword={{ form.keyword.value }}" >Featured results</a></li>{% endcomment %}
    <li><a href="{% url 'search-catalogue' %}" >Catalogue results</a></li>
    {% comment %}<li><a href="{% url 'search-website' %}?keyword={{ form.keyword.value }}" >Website results</a></li>{% endcomment %}
</ul>


<div class="column filters">

    <form method="get">
        {{ form.non_field_errors }}

        <div>
           {{ form.keyword.errors }}
           {{ form.keyword.label_tag }}
           {{ form.keyword }}
        </div>

        <ul>
            <h2>Buckets</h2>

            <li>
                {% bucket_count bucket_count_response 'tna' as tna_bucket_count %}
                <a href="{% url 'search-catalogue' %}?{% if form.keyword.value %}keyword={{ form.keyword.value }}&{% endif %}group=group:tna" >
                    Online records from The National Archives ({{ tna_bucket_count|intcomma }})
                </a>
            </li>
            <li>
                {% bucket_count bucket_count_response 'nonTna' as non_tna_bucket_count %}
                <a href="{% url 'search-catalogue' %}?{% if form.keyword.value %}keyword={{ form.keyword.value }}&{% endif %}group=group:nonTna" >
                    All records from other UK archives ({{ non_tna_bucket_count|intcomma }})
                </a>
            </li>
            <li>
                {% bucket_count bucket_count_response 'creator' as creator_bucket_count %}
                <a href="{% url 'search-catalogue' %}?{% if form.keyword.value %}keyword={{ form.keyword.value }}&{% endif %}group=group:creator" >
                    Record creators ({{ creator_bucket_count|intcomma }})
                </a>
            </li>
            <li>
                {% bucket_count bucket_count_response 'archive' as archive_bucket_count %}
                <a href="{% url 'search-catalogue' %}?{% if form.keyword.value %}keyword={{ form.keyword.value }}&{% endif %}group=group:archive" >
                    Directory of archives in the UK and beyond ({{ archive_bucket_count|intcomma }})
                </a>
            </li>
        </ul>

        <div>
           {{ form.group.errors }}
           {{ form.group.as_hidden }}
        </div>

        <div>
           {{ form.filter_keyword.errors }}
           {{ form.filter_keyword.label_tag }}
           {{ form.filter_keyword }}
        </div>

        {% if form.levels.field.choices %}
            <div>
               {{ form.levels.errors }}
               {{ form.levels.label_tag }}
               {{ form.levels }}
            </div>
        {% endif %}

        {% if form.topics.field.choices %}
            <div>
               {{ form.topics.errors }}
               {{ form.topics.label_tag }}
               {{ form.topics }}
            </div>
        {% endif %}

        {% if form.collections.field.choices %}
            <div>
               {{ form.collections.errors }}
               {{ form.collections.label_tag }}
               {{ form.collections }}
            </div>
        {% endif %}

        {% if form.closure_statuses.field.choices %}
            <div>
               {{ form.closure_statuses.errors }}
               {{ form.closure_statuses.label_tag }}
               {{ form.closure_statuses }}
            </div>
        {% endif %}

        {% if form.catalogue_sources.field.choices %}
            <div>
               {{ form.catalogue_sources.errors }}
               {{ form.catalogue_sources.label_tag }}
               {{ form.catalogue_sources }}
            </div>
        {% endif %}

        <input type="submit" />
    </form>


</div>

{% if page.paginator.count %}
    <div class="column results">

        {% with count=page.paginator.count per_page=page.paginator.per_page  %}
        <p>Showing {% if count < per_page %}{{ count }}{% else %}{{ per_page }}{% endif %} (of {{ count }}) result{{ count|pluralize}} for "{{ form.keyword.value|default:'*' }}" in "{{ form.group.value }}"</p>
        {% endwith %}

        <ul>
          {% for record in page %}
            <li>
                <h3> {{ record|record_title }} </h3>

                <dl>
                    <dt>IAID:</dt>
                    <dd>{{ record|record_iaid }}</dd>
                    <dt>Score:</dt>
                    <dd>{{ record|record_score }}</dd>
                </dl>
            </li>
          {% endfor %}
        </ul>

        <nav class="pagination" role="navigation" aria-label="Records pagination" data-container-name="Pagination"
             id="analytics-disambiguation-pagination">
            {% if page.has_other_pages %}
                <ul class="pagination__list">
                    {% if page.has_previous %}
                        <li class="pagination__list-item">
                            <a class="pagination__page-chevron-previous" href="?{% query_string page=page.previous_page_number %}"><span
                                    class="sr-only" data-link="Previous page">Previous page</span></a>
                        </li>
                    {% else %}
                        <li class="pagination__list-item">
                            <span class="pagination__page-chevron-previous--disabled"></span>
                        </li>
                    {% endif %}
                    <li class="pagination__list-pages" aria-label="Page numbers">
                        <ol>
                            {% for i in page.paginator.page_range %}
                                {% if page.number == i %}
                                    <li class="pagination__list-item">
                                        <a class="pagination__page-link-current" href="?{% query_string page=i %}"
                                           aria-label="Current page, Page {{ i }}"
                                           aria-current="true" data-link="{{ i }}"><span
                                                class="sr-only">Current page </span>{{ i }}</a>
                                    </li>
                                {% else %}
                                    <li class="pagination__list-item">
                                    <a class="pagination__page-link" href="?{% query_string page=i %}"
                                                                         aria-label="Go to page {{ i }}"
                                                                         data-link="{{ i }}"><span
                                            class="sr-only">Page </span>{{ i }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ol>
                    </li>
                    {% if page.has_next %}
                        <li class="pagination__list-item">
                            <a class="pagination__page-chevron-next" href="?{% query_string page=page.next_page_number %}"
                               data-link="Next page"><span class="sr-only">Next page</span></a>
                        </li>
                    {% else %}
                        <li class="pagination__list-item">
                            <span class="pagination__page-chevron-next--disabled"></span>
                        </li>
                    {% endif %}
                </ul>
            {% endif %}
        </nav>
    </div>
{% endif %}
