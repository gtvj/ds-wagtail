{% extends "base.html" %}

{% load datalayer_tags %}
{% load search_tags %}

{% block extra_gtm_js %}
    {% render_gtm_datalayer view %}
{% endblock extra_gtm_js %}
{% load humanize %}
{% load static %}
{% block breadcrumb %}
{% endblock %}
{% block content %}
    <form method="get" data-id="search-form" id="analytics-search-form">
        {% has_result_count buckets as buckets_have_a_result_count %}

        {{ form.non_field_errors }}

        {% with search_tab=searchtabs.CATALOGUE.value %}
            {% include './blocks/search_results_hero.html' %}
        {% endwith %}
        
        {% if buckets.current.result_count > 0 %}
            <p class="search-results__explainer--desktop">This page displays search results from our website.</p>
        {% endif %}

        {% if buckets_have_a_result_count %}
            {% include './blocks/website_search_buckets.html' %}
        {% endif %}
        
        <p class="search-results__explainer--mobile">Results from our website.</p>

        {% if buckets_have_a_result_count %}
            {% include './blocks/search_sort_and_view_options.html' %}
        {% endif %}

        {% if not buckets_have_a_result_count and not form.errors %}
            {% include './blocks/no_results.html' %}
        {% else %}
            <div class="catalogue-search-grid" data-id="catalogue-search-grid">
                <div class="catalogue-search-grid__sidebar" data-id="catalogue-search-sidebar">
                    {% include './blocks/search_filters.html' %}
                </div>
                <div class="catalogue-search-grid__results">
                    {% if page.paginator.count %}
                        {% include './blocks/search_results.html' %}
                    {% endif %}
                </div>
            </div>
        {% endif %}

        {% if page.paginator.count %}
            {% include './blocks/search_pagination.html' %}
        {% endif %}

        <div>
            {{ form.group.errors }}
            {{ form.group.as_hidden }}
        </div>
    </form>
{% endblock %}

{% block extra_js %}
<script src="{% static 'scripts/catalogue_search.js' %}"></script>
{% endblock %}
