{% load wagtailimages_tags %}
{% load search_tags %}

{% extended_in_operator buckets.current.key bucketkeys.INSIGHT.value bucketkeys.HIGHLIGHT.value as apply_teaser_image %}
{% if apply_teaser_image %}
    {% image record.source_page.teaser_image fill-288x172 as teaser_image_small %}
    {% image record.source_page.teaser_image fill-328x196 as teaser_image_medium %}
    {% image record.source_page.teaser_image fill-348x208 as teaser_image_large %}
    {% image record.source_page.teaser_image fill-508x304 as teaser_image_extra_large %}
{% endif %}

{% comment %} TODO downloadable, and record variables {% endcomment %}
{% load search_tags records_tags static %}

<li class="search-results__list-card--grid">
    {% if record|record_detail:"digitised" %}
    <div class="search-results__list-card-delivery-options--grid">
        <a href="{% record_url record %}" aria-hidden="true" tabindex="-1">
            <img src="{% static 'images/etna-search-view-download-icon.png' %}" class="search-results__list-card-delivery-options-img" alt="" />
        </a>
    </div>
    {% endif %}
    <div class="search-results__list-card-content">
        <h4 class="search-results__list-card-heading">
            {% if apply_teaser_image %}
                <div class="search-results__list-card-full-width-image">
                    <picture>
                        <source media="(max-width: 768px)" srcset="{{ teaser_image_extra_large.url }}">
                        <source media="(max-width: 991px)" srcset="{{ teaser_image_medium.url }}">
                        <source media="(max-width: 1199px)" srcset="{{ teaser_image_small.url }}">
                        <source media="(min-width: 1200px)" srcset="{{ teaser_image_large.url }}">
                        <img src="{{ teaser_image_large.url }}" alt="">
                    </picture>
                </div>
            {% endif %}
            <a href="{% record_url record %}" class="search-results__list-card-link" data-analytics-link="{{ record|record_detail:"referenceNumber"|default:"N/A" }} - {{ record|record_title }}"><span class="sr-only">{{ record|record_detail:"referenceNumber"|default:"N/A" }}</span>
            {{ record|record_title}}
            </a>
        </h4>
        <p class="search-results__list-card-description">
            {{ record|record_description}}
        </p>
        <ul class="search-results__list-card-metadata">
            {% if record|record_detail:"heldBy" %}
                <li class="search-results__list-card-metadata-item">
                    Held by: {{ record|record_detail:"heldBy" }}
                </li>
            {% endif %}

            {% if record|record_detail:"dateCreated" %}
                <li class="search-results__list-card-metadata-item">
                    Date: {{ record|record_detail:"dateCreated"|default:"N/A" }}
                </li>
            {% endif %}

            {% if record|record_detail:"referenceNumber" %}
            <li class="search-results__list-card-metadata-item">

                {% if form.group.value == 'archive' %}
                Archon code:
                {% else %}
                Catalogue reference:
                {% endif %}

                {% if record|record_detail:"recordOpening" %}
                <li class="search-results__list-card-metadata-item">
                    Record Opening Date: {{ record|record_detail:"recordOpening"|default:"N/A" }}
                </li>
                {% endif %}

                {{ record|record_detail:"referenceNumber"|default:"N/A" }}
            </li>
            {% endif %}

            {% if form.group.value ==  bucketkeys.CREATOR.value %}
                {% if record|record_detail:"type" %}
                    <li class="search-results__list-card-metadata-item">
                        Type: {{ record|record_detail:"type"|default:"N/A" }}
                    </li>
                {% endif %}
            {% endif %}

            {% comment %}Debug attributes. Output to allow k-int to adjust the ES index{% endcomment %}
            <!-- <li class="search-results__list-card-metadata-item">
                IAID: {{ record|record_detail:"iaid" }}
            </li>
            <li class="search-results__list-card-metadata-item">
                Score: {{ record|record_score }}
            </li> -->
            {% comment %}End debug attributes.{% endcomment %}
        </ul>
    </div>
</li>
