{% load static records_tags search_tags wagtailimages_tags %}

{% extended_in_operator buckets.current.key bucketkeys.INSIGHT.value bucketkeys.HIGHLIGHT.value as apply_teaser_image %}
{% if apply_teaser_image %}
    {% image record.source_page.teaser_image fill-288x172 as teaser_image_small %}
    {% image record.source_page.teaser_image fill-328x196 as teaser_image_medium %}
    {% image record.source_page.teaser_image fill-348x208 as teaser_image_large %}
    {% image record.source_page.teaser_image fill-508x304 as teaser_image_extra_large %}
{% endif %}

{% comment %} TODO downloadable, and record variables {% endcomment %}


<li class="search-results__list-card--grid">

    <div class="search-results__list-card-content">

        <h4 class="search-results__list-card-heading">
            {% if apply_teaser_image %}
                <div class="search-results__list-card-full-width-image">
                    <picture>
                        <source media="(max-width: 768px)" srcset="{{ teaser_image_extra_large.url }}">
                        <source media="(max-width: 991px)" srcset="{{ teaser_image_medium.url }}">
                        <source media="(max-width: 1199px)" srcset="{{ teaser_image_small.url }}">
                        <source media="(min-width: 1200px)" srcset="{{ teaser_image_large.url }}">
                        <img src="{{ teaser_image_large.url }}" alt="">
                    </picture>
                </div>
            {% endif %}
            <a href="{% if form.group.value == bucketkeys.ARCHIVE.value %}{% record_url record use_non_reference_number_url=True %}{% else %}{% record_url record %}{% endif %}" class="search-results__list-card-link" data-analytics-link="{{ record.reference_prefixed_summary_title }}">
                {% if record.reference_number %}<span class="sr-only">{{ record.reference_number }}</span>{% endif %}
                {{ record.summary_title }}
            </a>
        </h4>
        <p class="search-results__list-card-description">
            {{ record.listing_description }}
        </p>
        <dl class="search-results__list-card-metadata">
            {% if record.held_by %}
                <dt class="search-results__list-card-metadata-item search-results__list-card-metadata-item-held-by-icon">
                    Held by:
                </dt>
                <dd>{{ record.held_by }}</dd>
            {% endif %}

            {% if record.date_created %}
                <dt class="search-results__list-card-metadata-item search-results__list-card-metadata-item-date-icon">
                    Date:
                </dt>
                <dd> {{ record.date_created }}</dd>
            {% endif %}

            {% if record.reference_number %}
            <dt class="search-results__list-card-metadata-item search-results__list-card-metadata-item-data-icon">

                {% if form.group.value == 'archive' %}
                Archon code:
                {% else %}
                Reference:
                {% endif %}


            </dt>
            <dd>{{ record.reference_number }}</dd>
            {% endif %}

            <!--
            {% if record.record_opening %}
                <dt class="search-results__list-card-metadata-item search-results__list-card-metadata-item-subjects-icon">
                    Record opening date:
                </dt>
                <dd>{{ record.record_opening }}</dd>
            {% endif %}
            -->
            {% if form.group.value == bucketkeys.CREATOR.value and record.type %}
                <dt class="search-results__list-card-metadata-item">
                    Type:
                </dt>
                <dd>{{ record.type }}</dd>
            {% endif %}

            {% comment %}Debug attributes. Output to allow k-int to adjust the ES index{% endcomment %}
            <!--
            <dt class="search-results__list-card-metadata-item">
                IAID:
            </dt>

            <dd>{{ record.iaid }}</dd>>
            <dt class="search-results__list-card-metadata-item">
                Score:
            </dt>
            <dd;>{{ record.score }}</dd>
            -->
            {% comment %}End debug attributes.{% endcomment %}
        </dl>


    {% if record.is_digitised %}
        {% if record.closure_status not in closure_closed_status %}
            <div class="search-results__list-card-delivery-options--grid">
                <a href="{% record_url record %}" aria-hidden="true" tabindex="-1" data-link="{{ record.reference_prefixed_summary_title }}" data-link-type="Search result thumbnail link" data-position="{{forloop.counter0}}" search-bucket="{{ buckets.current.label }}">
                <img src="{% static 'images/grid-placeholder.png' %}"  class="search-results__list-card-delivery-options-img search-image-grid" alt="" />
                </a>
                <a href="{% record_url record %}" class="search-results__list-card-delivery-options-link">
                    <p class="search-results__list-card-delivery-options-desc search-results-grid">
                        <span class="sr-only">{{ record.reference_prefixed_summary_title }} is</span>
                        Available online
                    </p>
                </a>
            </div>
        {% endif %}
    {% endif %}
</li>
