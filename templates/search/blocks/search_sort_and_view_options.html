{% load search_tags %}


<div class="search-sort-view">
    <form method="GET" class="search-sort-view__form search-sort-view__desktop" data-id="sort-form" id="catalogue-sort-form-desktop" data-search-type="{% with request.resolver_match.url_name as url_name %}{% if url_name == 'search-featured' %}{{ searchtabs.ALL.value }}{% elif url_name == 'search-catalogue' %}{{ searchtabs.CATALOGUE.value }}{% elif url_name == 'search-website' %}{{ searchtabs.WEBSITE.value }}{% endif %}{% endwith %}" data-search-bucket="{{ buckets.current.label }}" data-search-filter-name="Sort results" data-search-filter-value="">

        <h2 class="search-sort-view__heading">
           <label for="{{form.sort_by.id_for_label}}">Sort by</label>
        </h2>
        
        {{ form.sort_by.errors }}
        {{ form.sort_by }}

        {{ 'sort_by'|include_hidden_fields:form }}

        <input type="submit" value="Update" class="search-sort-view__form-submit">
    </form>

    <h2 class="search-sort-view__heading"><span class="sr-only">Display as:</span></h2>
    <ul class="search-sort-view__list">

        <li class="search-sort-view__list-item">
            {% if form.cleaned_data.display == 'list' or form.cleaned_data.display == '' %}
                <span aria-current="true" class="search-sort-view__icon">
                    {% include "includes/icon.html" with name="list" classname="search-sort-view__svg" %}
                    <span class="sr-only">Displaying results as a list</span>
                </span>
            {% else %}
                <a href="?{% query_string_include 'display' 'list' %}" id="listview" search-type="{% with request.resolver_match.url_name as url_name %}{% if url_name == 'search-featured' %}{{ searchtabs.ALL.value }}{% elif url_name == 'search-catalogue' %}{{ searchtabs.CATALOGUE.value }}{% elif url_name == 'search-website' %}{{ searchtabs.WEBSITE.value }}{% endif %}{% endwith %}" search-bucket="{{ buckets.current.label }}" search-filter-name="Sort results" search-filter-value="Display results as a list" class="search-sort-view__icon">
                    {% include "includes/icon.html" with name="list" classname="search-sort-view__svg" %}
                    <span class="sr-only">Displaying results as a list</span>
                </a>
            {% endif %}
        </li>
        <li class="search-sort-view__list-item">
            {% if form.cleaned_data.display == 'grid' %}
                <span aria-current="true" class="search-sort-view__icon">
                    {% include "includes/icon.html" with name="grid" classname="search-sort-view__svg" %}
                    <span class="sr-only">Displaying results as a grid</span>
                </span>
            {% else %}
                <a href="?{% query_string_include 'display' 'grid' %}" id="gridView" search-type="{% with request.resolver_match.url_name as url_name %}{% if url_name == 'search-featured' %}{{ searchtabs.ALL.value }}{% elif url_name == 'search-catalogue' %}{{ searchtabs.CATALOGUE.value }}{% elif url_name == 'search-website' %}{{ searchtabs.WEBSITE.value }}{% endif %}{% endwith %}" search-bucket="{{ buckets.current.label }}" search-filter-name="Sort results" search-filter-value="Display results as a grid" class="search-sort-view__icon">
                    {% include "includes/icon.html" with name="grid" classname="search-sort-view__svg" %}
                    <span class="sr-only">Display results as a grid</span>
                </a>
            {% endif %}
        </li>
    </ul>

    {{ form.display.errors }}
    {{ form.display.as_hidden }}
</div>

<script>
    // get value of selected option based on id : id_sort_by

    function getOption() {
        selectElement = document.querySelector('#id_sort_by');
        output = selectElement.options[selectElement.selectedIndex].value.trim();
        document.getElementById("catalogue-sort-form-desktop").setAttribute("data-search-filter-value", output);

        selectElement.onchange = function() {
            let output = this.options[this.selectedIndex].value.trim();

            document.getElementById("catalogue-sort-form-desktop").setAttribute("data-search-filter-value", output);
        }
    }

    getOption();
</script>

